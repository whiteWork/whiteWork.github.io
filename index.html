<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测地址</title>
    <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="sun.ico" rel="icon" type="image/x-icon" />
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/common.js"></script>
    <script src="js/move.js"></script>
    <script src="js/jquery-1.10.2.js"></script>
</head>
<body>
    <div class="add_address1" id="add_addressBox">
            <!-- <nav>
                <div class="nav_left">
                    <a href="javascript:history.go(-1);" class="go_back"></a>
                </div>
                <h2>我的地址</h2>
            </nav> -->
                <div class="main">
                    <div class="address_des">
                        <ul>
                            <li class="lbs">
                                <div id="allmap"></div><i></i><input type="text" id="address" placeholder="" /><b></b>
                            </li>
                            <li>
                                <input type="text" id="house_number" placeholder=""/><b></b>
                            </li>
                        </ul>
                    </div>
                    <div class="del_address"><a href="javascript:;">删除地址</a></div>
                </div>
                <div class="setBtn"><a href="javascript:;" id="sava_address">保存</a></div>

    </div>
    <div class="commont_popup2">
        <div class="main">
            <p class="hint_txt">是否删除收货地址</p>
            <div class="popup_btn">
                <a href="javascript:;" class="cancel_btn">取消</a>
                <a href="javascript:;" class="confirm_btn">确定</a>
            </div>
        </div>
    </div>
    <div class="commont_popup">
        <div class="main">
            <p class="hint_txt">删除成功!</p>
            <a href="javascript:;" class="confirm_txt">确定</a>
        </div>
    </div>
    <script>
        $(function(){
            var regPhone = /^1[34578][0-9]{9}$/;
            $('#sava_address').click(function(){
                if($('#address').val()==""){
                    tishi('请输入所在位置');
                }else if($('#address').val()=="正要获取您的位置..."){
                    tishi('正在获取您的位置，请稍侯再提交');

                }else if($('#house_number').val()==""){
                    tishi('请输入详细地址');

                }else if($('#user_name').val()==""){
                    tishi('请输入姓名');

                }else if($('#user_mobile').val()==""||!regPhone.test($('#user_mobile').val())){
                    tishi('请输入正确的联系方式');

                }else{
                    var url = "/user/updata_address_pro?id=<?php echo $type['ua_id']?>&t_id=<?php echo $type['t_id']?>&td_id=<?php echo $type['td_id']?>&tdd_id=<?php echo $type['tdd_id']?>";
                    var data = {
                        ua_content:$('#address').val(),
                        ua_number:$('#house_number').val(),
                        ua_name:$('#user_name').val(),
                        ua_mobile:$('#user_mobile').val(),
                        ua_id:$('#user_id').val(),
                        ua_default_status:1
                    }
                    $.post(url,data,function(data){
                        if(data.ok==1){
                            window.location.href="/order/xinxi?t_id="+$('#t_id').val()+"&td_id="+$('#td_id').val()+"&tdd_id="+$('#tdd_id').val();

                        }else{
                            tishi(data.msg);
                        }

                    });
                }
            });
            $('#set_address').click(function(){
                if($('#address').val()==""){
                    tishi('请输入地址');
                }else if($('#address').val()=="正要获取您的位置..."){
                    tishi('正在获取您的位置，请稍侯再提交');

                }else if($('#address').val().indexOf("北京")==-1){
                    tishi('其他地区请等待开通');

                }else if($('#house_number').val()==""){
                    tishi('请输入您的详细地址');
                }else if($('#user_name').val()==""){
                    tishi('请输入您的姓名');

                }else if($('#user_mobile').val()==""||!regPhone.test($('#user_mobile').val())){
                    tishi('请输入正确的联系方式');

                }else{ 
                    var url = "/user/add_address";
                    var data = {
                        ua_content:$('#address').val(),
                        ua_number:$('#house_number').val(),
                        ua_name:$('#user_name').val(),
                        ua_mobile:$('#user_mobile').val(),
                        ua_default_status:1
                    }
                    $.post(url,data,function(data){
                        if(data.ok==1){
                            window.location.href="/user/address"

                        }else{
                            tishi(data.msg);
                        }
                    });
                } 
            });
        });

        $(function(){
            $('.del_address').click(function(){
                
                $('.commont_popup2').show();
            });
            $('.commont_popup2 .cancel_btn').click(function(){
                $('.commont_popup2').hide();
            });
            $('.commont_popup2 .confirm_btn').click(function(){
                var url = "/order/del_address";
                var data = {
                    ua_id:$('#user_id').val()
                };
                $.post(url,data,function(data){
                    if(data.ok==1){
                        window.location.href="/order/address"
                    }else{
                        tishi(data.msg);
                    }
                });
            });
        });

        $(function(){
            $('#add_addressBox .address_des li b').click(function(){
                $(this).parents('li').find('input').val('');
            });

        });
    </script>
    <script src="http://api.map.baidu.com/api?v=1.5&ak=AdHc7b48OpoqvMehQCuNbRPL" type="text/javascript"></script>
    <script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>
    <script type="text/javascript">
        var LBS=document.getElementById("address");
        getLocation();
        function getLocation(){
            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(showPosition,onError);
            }else{
                tishi("您的浏览器不支持地理定位");
            }
        }
        function showPosition(position){
            lat=position.coords.latitude;
            lon=position.coords.longitude;
            var gpsPoint  = new BMap.Point(lon, lat); 
            var map = new BMap.Map("allmap");            // 创建Map实例
            map.centerAndZoom(gpsPoint ,15);  
            map.addControl(new BMap.NavigationControl());
            setTimeout(function(){
                 BMap.Convertor.translate(gpsPoint ,0,translateCallback); 
            }, 1000);
        }
        translateCallback = function (point){
            var marker = new BMap.Marker(point);
            var gc = new BMap.Geocoder();
            gc.getLocation(point, function(rs){
                var addComp = rs.addressComponents;
                if(addComp.province==addComp.city){
                    LBS.value =  addComp.city +addComp.district +addComp.street + addComp.streetNumber;
                    localStorage.setItem('address',LBS.value );

                }else{
                    LBS.value  = addComp.province + addComp.city +addComp.district +addComp.street + addComp.streetNumber;
                    localStorage.setItem('address',LBS.value );

                }
            });
        }

        function onError(error){
            switch(error.code){
               case 1:
               tishi("位置服务被拒绝,请手动输入",2000);
               LBS.value=""
               break;

               case 2:
               tishi("暂时获取不到位置信息,请手动输入",2000);
               LBS.value=""
               break;

               case 3:
               tishi("获取信息超时,请手动输入",2000);
               LBS.value=""
               break;

               case 4:
                tishi("未知错误,请手动输入",2000);
                LBS.value=""
               break;
            }
        }
    </script>
</body>
</html>